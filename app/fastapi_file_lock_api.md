> ì´ ë¬¸ì„œëŠ” ChatGPTë¥¼ í†µí•´ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.
# FastAPI ê¸°ë°˜ íŒŒì¼ ì ê¸ˆ API

## ğŸ“ í”„ë¡œì íŠ¸ ê°œìš”

ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ì´ë¯¸ì§€ ë¼ë²¨ë§ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤ì—ì„œ, ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ FastAPI ê¸°ë°˜ ë°±ì—”ë“œ APIì…ë‹ˆë‹¤.

- í”„ë¡œì íŠ¸ ë‚´ ë™ì¼ íŒŒì¼ì— ëŒ€í•´ ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ì‘ì—…í•˜ëŠ” ì¶©ëŒ ë°©ì§€
- ì‚¬ìš©ìë‹¹ í•œ ê°œì˜ íŒŒì¼ë§Œ ë™ì‹œì— ì‘ì—…í•˜ë„ë¡ ì œí•œ
- ì‹¤ì‹œê°„ íŒŒì¼ ì ê¸ˆ ìƒíƒœ ê´€ë¦¬
- ì¼ì • ì‹œê°„ë™ì•ˆ ì‘ì—… ì—†ì„ ì‹œ ìë™ ì ê¸ˆ í•´ì œ ì²˜ë¦¬

---

## ğŸ”§ ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ

- **Python 3.11**
- **FastAPI**: ë¹„ë™ê¸° API ì„œë²„ êµ¬í˜„
- **Uvicorn**: ASGI ì„œë²„
- **Redis**: íŒŒì¼ ì ê¸ˆ ìƒíƒœ ê´€ë¦¬ ë° TTL ì„¤ì •
- **Socket.IO (via `python-socketio`, `socket.io-client`)**: ì‹¤ì‹œê°„ í†µì‹ 
- **aiofiles**: ë¹„ë™ê¸° íŒŒì¼ ì²˜ë¦¬

---

## âš™ï¸ ê¸°ëŠ¥ ì„¤ëª…

### 1. íŒŒì¼ ì ê¸ˆ (Lock)
- í•œ ì‚¬ìš©ìê°€ íŠ¹ì • í”„ë¡œì íŠ¸ì˜ íŒŒì¼ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ íŒŒì¼ì— ëŒ€í•œ ì ê¸ˆ ìš”ì²­ ì „ì†¡
- Redisì— `"lock:{project_id}:{file_name}"` í‚¤ë¡œ ì ê¸ˆ ì •ë³´ ì €ì¥
- ì´ë¯¸ ì ê¸ˆ ìƒíƒœì¼ ê²½ìš°, ì ê¸ˆ ì‚¬ìš©ì ì •ë³´ ë°˜í™˜

### 2. íŒŒì¼ ì ê¸ˆ í•´ì œ (Unlock)
- ì‚¬ìš©ìê°€ íŒŒì¼ ì‘ì—…ì„ ì¢…ë£Œí•˜ê±°ë‚˜ ì¼ì • ì‹œê°„ ì´ìƒ ì‘ì—…ì´ ì—†ì„ ê²½ìš° ìë™ í•´ì œ
- `unlock_file` API ë˜ëŠ” TTL(Time-To-Live) ê¸°ë°˜ ìë™ í•´ì œ

### 3. ì ê¸ˆ ìƒíƒœ ì¡°íšŒ
- í´ë¼ì´ì–¸íŠ¸ê°€ íŠ¹ì • í”„ë¡œì íŠ¸ì˜ ëª¨ë“  íŒŒì¼ ì ê¸ˆ ìƒíƒœ ì¡°íšŒ ê°€ëŠ¥
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‹¤ì‹œê°„ í‘œì‹œ ê°€ëŠ¥

### 4. ì‹¤ì‹œê°„ ì ê¸ˆ/í•´ì œ ì•Œë¦¼
- í´ë¼ì´ì–¸íŠ¸ê°€ WebSocketìœ¼ë¡œ ì„œë²„ì™€ ì—°ê²°
- ì ê¸ˆ/í•´ì œ ì‹œ ê´€ë ¨ ì´ë²¤íŠ¸ë¥¼ í•´ë‹¹ ë°©(room)ì˜ í´ë¼ì´ì–¸íŠ¸ë“¤ì—ê²Œ ë¸Œë¡œë“œìºìŠ¤íŒ…

---

## ğŸ”Œ API ëª…ì„¸

| Method | Endpoint                    | ì„¤ëª…                          |
|--------|-----------------------------|-------------------------------|
| POST   | `/lock`                     | íŒŒì¼ ì ê¸ˆ ìš”ì²­                |
| POST   | `/unlock`                   | íŒŒì¼ ì ê¸ˆ í•´ì œ                |
| GET    | `/status/{project_id}`      | í”„ë¡œì íŠ¸ ë‚´ íŒŒì¼ ì ê¸ˆ ìƒíƒœ ì¡°íšŒ |

---

## ğŸ”„ WebSocket ì´ë²¤íŠ¸ ëª…ì„¸

### âœ… í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„
- `join_project`: í”„ë¡œì íŠ¸ ë°© ì…ì¥
```json
{ "project_id": "1234", "user_id": "user1" }
```

- `leave_project`: ë°© í‡´ì¥
- `heartbeat`: ì£¼ê¸°ì  ì‹ í˜¸ë¡œ TTL ì—°ì¥ (ì˜ˆ: 30ì´ˆë§ˆë‹¤)

---

### ğŸ“¢ ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸
- `lock_acquired`
```json
{ "file": "image1.jpg", "user": "user1" }
```

- `lock_released`
```json
{ "file": "image1.jpg" }
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë° ì‚¬ìš©ë²•

### 1. ì„œë²„ ì‹¤í–‰

```bash
uvicorn main:app --reload
```

### 2. Swagger ë¬¸ì„œ
http://127.0.0.1:8000/docs

---

## âš ï¸ ìì£¼ ê²ªëŠ” ë¬¸ì œ ë° í•´ê²°

### ë¬¸ì œ 1: ì ê¸ˆ ìƒíƒœ TTLì´ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ
- ì›ì¸: í´ë¼ì´ì–¸íŠ¸ê°€ heartbeatë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ë³´ë‚´ì§€ ì•ŠìŒ
- í•´ê²°: WebSocket ì—°ê²° í›„ ì¼ì • ì£¼ê¸°ë¡œ `heartbeat` ì´ë²¤íŠ¸ ì „ì†¡

### ë¬¸ì œ 2: ì‹¤ì‹œê°„ ì ê¸ˆ í•´ì œ ì´ë²¤íŠ¸ ëˆ„ë½
- ì›ì¸: ì‚¬ìš©ìê°€ ì†Œì¼“ ì—°ê²° ì¢…ë£Œ ì—†ì´ ë¸Œë¼ìš°ì € ì¢…ë£Œ
- í•´ê²°: WebSocket ì—°ê²° ëŠê¹€ ê°ì§€ í›„ ì„œë²„ ì¸¡ì—ì„œ ìë™ í•´ì œ ì²˜ë¦¬

### ë¬¸ì œ 3: WebSocket ë©”ì‹œì§€ê°€ ìˆ˜ì‹ ë˜ì§€ ì•ŠìŒ
- ì›ì¸: í´ë¼ì´ì–¸íŠ¸ì—ì„œ `onmessage` í•¸ë“¤ëŸ¬ ë¯¸ì„¤ì •
- í•´ê²°: ë‹¤ìŒê³¼ ê°™ì´ ë“±ë¡

```javascript
ws.onmessage = (event) => {
    const messages = document.getElementById("messages");
    const message = document.createElement("li");
    message.textContent = event.data;
    messages.appendChild(message);
};
```

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡° ì˜ˆì‹œ

```
.
â”œâ”€â”€ main.py              # FastAPI ì„œë²„ ì‹¤í–‰
â”œâ”€â”€ redis_manager.py     # Redisë¥¼ ì´ìš©í•œ ì ê¸ˆ ê´€ë¦¬
â”œâ”€â”€ websocket.py         # ì‹¤ì‹œê°„ ì†Œì¼“ ì´ë²¤íŠ¸ ì²˜ë¦¬
â”œâ”€â”€ schemas.py           # Pydantic ëª¨ë¸ ì •ì˜
â””â”€â”€ requirements.txt     # ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ëª©ë¡
```

---

## ğŸ“Œ ê¸°íƒ€ ì°¸ê³  ì‚¬í•­

- `.md` íŒŒì¼ì€ GitHub, GitLab, Notion ë“±ì—ì„œ ê°€ë…ì„±ì´ ì¢‹ê³ , í˜‘ì—…ì— ì í•©í•©ë‹ˆë‹¤.
- FastAPIëŠ” Swagger ë¬¸ì„œë¥¼ ìë™ ìƒì„±í•˜ì—¬ API í…ŒìŠ¤íŠ¸ë¥¼ ì‰½ê²Œ í•´ì¤ë‹ˆë‹¤.
- Redisì˜ TTL ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ ìë™ ì ê¸ˆ í•´ì œ ì²˜ë¦¬ë¥¼ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.
